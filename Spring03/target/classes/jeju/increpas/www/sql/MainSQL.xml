<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mSQL">
<!--  < 메인 페이지 - 메인 폼 요청 > 질의명령 -->
	<!-- 리뷰 가져오기 -->
	<select id="getReviewInfo" resultType="rVO" parameterType="mVO">
		SELECT  
			id, rno, review.rpno rpno, rtitle, rbody, rdate, rhit, rgrade, rx, ry   
		FROM   
			review, member 
		WHERE   
			rx= #{ax}  
		    AND review.mno = member.mno 
		    AND ry= #{ay}
		    AND review.isshow='Y' 
		ORDER BY 
		   	rdate DESC
	</select>
	<!-- 리뷰 사진 가져오기 -->
	<select id="getReviewPhoto" resultType="rpVO" parameterType="mVO">
		SELECT
			rno, rponame, rpsname, rpdir
		FROM
			review, rphoto
		WHERE
			rphoto.rpno = review.rpno
			AND rx = #{ax}
			AND ry = #{ay}
			AND review.isshow='Y'
	</select>
	<!-- 리뷰 조회수 업데이트 -->
	<update id="setReviewHit" parameterType="int">
		UPDATE
			review
		SET
			rhit = rhit+1
		WHERE
			rno = #{rno}
	</update>
	<!-- 자세히보기 가져오기 -->
	<select id="getStoreInfo" resultType="iVO" parameterType="mVO">
		SELECT  
		    *  
		FROM  
		    areainfo, aphoto  
		WHERE  
		   areainfo.apno = aphoto.apno  
		    AND ax= #{ax}  
		    AND ay= #{ay}
		    AND isshow='Y'  		
	</select>
	<!-- 맵 정보 가져오기 -->
	<select id="getMapInfo" resultType="mVO">
		SELECT
			ano, aname, ax, ay
		FROM
			areainfo
	</select>
	<!-- 로그인기능 -->
	<select id="Login" resultType="int" parameterType="meVO">
		Select
			count(*) cnt
		FROM
			member
		WHERE
			id = #{id}
			AND pw = #{pw}
			AND isshow = 'Y' 
	</select>
	<!-- id정보로 회원 번호 가져오기 -->
	<select id="getMno" resultType="int" parameterType="string">
		SELECT
			mno
		FROM
			member
		WHERE
			isshow = 'Y'
			AND id = #{id}
	</select>
	<!-- 찜하기 전 중복여부 체크기능 -->
	<select id="favoriteCheck" resultType="int" parameterType="faVO">
		SELECT
			COUNT(*) cnt
		FROM
			favorite
		WHERE
			mno = #{mno}
			AND ano = #{ano}
	</select>
	<!-- 찜하기 추가기능 -->
	<insert id="setFavorite" parameterType="faVO">
		INSERT INTO
			favorite(fno, mno, ano)
		VALUES(
    		(select nvl(max(fno)+1, 1) from favorite),
    		#{mno}, #{ano}
		)
	</insert>
</mapper>